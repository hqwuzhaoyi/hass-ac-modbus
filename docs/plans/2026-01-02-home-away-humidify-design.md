# 居家/离家/加湿功能设计

## 概述

通过 Wireshark 抓包逆向分析空调的居家、离家、加湿功能对应的 Modbus 寄存器，并在 WebUI 和 Home Assistant 中实现控制。

## 功能分类

| 功能组 | 功能 | 类型 | 预期实现 |
|--------|------|------|----------|
| 模式 | 居家 | 互斥选择 | 同一寄存器不同值 |
| 模式 | 离家 | 互斥选择 | 同一寄存器不同值 |
| 加湿 | 加湿开关 | 独立开关 | 独立寄存器或 bit 位 |

## 实施阶段

### 阶段 1：Wireshark 数据分析

**操作流程**：
1. 操作空调面板触发功能
2. 在网关侧抓取 Modbus 流量
3. 每个功能单独抓包，发送 Wireshark 文本导出

**分析目标**：
- 识别功能码（06/10）
- 确定寄存器地址
- 解析写入值含义

### 阶段 2：寄存器验证

使用现有 WebSocket 服务手动读写寄存器，确认功能映射正确。

### 阶段 3：WebUI 集成

**新增组件**：
- `components/home-away-control.tsx` - 居家/离家模式切换
- `components/humidify-control.tsx` - 加湿开关

**UI 设计**：
- 居家/离家：Radio Group 或 Toggle Group
- 加湿：Switch 开关

### 阶段 4：Home Assistant 集成

**扩展 custom_components/ac_modbus**：
- 居家/离家：`select` 实体
- 加湿：`switch` 实体

## 寄存器发现记录

> 以下内容将在 Wireshark 分析后填充

### 居家功能
- 寄存器地址：待定
- 写入值：待定

### 离家功能
- 寄存器地址：待定
- 写入值：待定

### 加湿功能
- 寄存器地址：待定
- 开启值：待定
- 关闭值：待定

## 验证清单

- [ ] 居家寄存器读写验证
- [ ] 离家寄存器读写验证
- [ ] 加湿开启/关闭验证
- [ ] WebUI 组件功能测试
- [ ] Home Assistant 实体测试
